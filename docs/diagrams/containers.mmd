C4Container
title apipratudo - Containers

Person(integrator, "Developer/Integrador", "Administra apps e chaves")

System_Boundary(apipratudo, "apipratudo") {
  Container(api_gateway, "api-gateway", "Spring Boot", "Entrada unica /v1")
  Container(quota_service, "quota-service", "Spring Boot", "Quotas e rate limits")
  Container(webhook_service, "webhook-service", "Spring Boot", "Cadastro e entrega de webhooks")
  Container(file_service, "file-service", "Spring Boot", "APIs de arquivos")
  Container(cep_service, "cep-service", "Spring Boot", "APIs de CEP")
  Container(dev_portal, "developer-portal", "Web app", "Onboarding e docs")

  ContainerDb(postgres, "PostgreSQL", "Dados transacionais")
  ContainerDb(redis, "Redis", "Cache e fila")

  Container(identity, "identity/keycloak", "Keycloak", "OIDC e JWT")
  Container(otel_collector, "otel-collector", "OpenTelemetry", "Coleta de telemetria")
  Container(observability, "observability", "Traces, logs e metrics", "Backend de observabilidade")
}

Rel(integrator, dev_portal, "Usa")
Rel(dev_portal, api_gateway, "Chama APIs /v1")

Rel(api_gateway, identity, "Valida JWT")
Rel(api_gateway, quota_service, "Consulta limites")
Rel(api_gateway, webhook_service, "Encaminha chamadas")
Rel(api_gateway, file_service, "Encaminha chamadas")
Rel(api_gateway, cep_service, "Encaminha chamadas")

Rel(webhook_service, postgres, "Le/Escreve")
Rel(file_service, postgres, "Le/Escreve")
Rel(cep_service, postgres, "Le/Escreve")
Rel(quota_service, redis, "Le/Escreve")
Rel(webhook_service, redis, "Fila de entrega")
Rel(api_gateway, redis, "Cache")

Rel(api_gateway, otel_collector, "Envia telemetria")
Rel(webhook_service, otel_collector, "Envia telemetria")
Rel(quota_service, otel_collector, "Envia telemetria")
Rel(file_service, otel_collector, "Envia telemetria")
Rel(cep_service, otel_collector, "Envia telemetria")
Rel(dev_portal, otel_collector, "Envia telemetria")
Rel(otel_collector, observability, "Exporta")
